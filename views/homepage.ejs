<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/0dbb6b0e47.js" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/js/multiselect.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/css/homepage-style.css">

  <!-- Favicons -->
  <link href="assets/img/favicon.svg" rel="icon">

  <title>Profile Portal</title>
</head>
<body>
    <header id="home" class="hero-area">
      <div class="overlay">
        <span></span>
        <span></span>
      </div>
      <div class="Header">
        <nav class="navbar navbar-expand-md fixed-top">
          <div class="container">
            <a class="d-flex navbar-brand" href="#"><i class="fab fa-product-hunt fa-3x"></i><span class="align-self-center">Profile Portal</span></a>
            <input class="menu-btn navbar-toggler" id="menu-btn" type="checkbox" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto w-100 justify-content-end">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <!--  <i class="fas fa-user-circle fa-2x"></i> -->
                  Profile
                </a>
                <ul class="dropdown-menu arrow" aria-labelledby="navbarDropdown">
                  <li><a class="dropdown-item" href="editprofile">Edit Profile</a></li>
                  <li><a class="dropdown-item" href="logout">Logout</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="about">About</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-xs-12">
          <div class="contents">
            <h2 class="head-title">Profile Portal</h2>
            <p>Your one stop destination to contact anyone in insti sharing similar hobbies or proficient in any skill you wish to explore.</p>
          </div>
        </div>
        <div class="col-lg-6 col-md-12 col-xs-12 p-0">
          <div class="intro-img">
            <img src="/images/portal-home.png" alt="">
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- //////////////////// Search Section ////////////////////// -->

  <section id= "search" class="section">
    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-sm-10">
          <form class="d-flex">
            <div class="col-sm-10 m-1">
              <div class="input-group search-bar">
                <input class="form-control border-0 m-2 p-0 bg--light Focus" type="search" name="name" placeholder="Search Profiles..." aria-label="Search" aria-describedby="search-icon" autocomplete="off">
                <button class="btn btn-link text-primary" type="submit" id="search-btn"><i class="fas fa-search "></i></button>
              </div>
            </div>
            <!-- <button class="button btn-singin m-1 border-1" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
              Filters
            </button> -->
          </form>
          <div class="collapse show" id="collapse-Example">
            <div class="filter-section col-sm-10 m-1 p-2">

              <div class="row justify-content-center align-items-center m-3">
                <div class="col-3 text-center">
                  <h5>PoRs</h5>
                </div>
                <div class="col-sm-9">
                  <div class="">
                    <select id="pors" multiple data-multi-select-plugin>
                      <% pors.forEach(function(object){ %>
                       <option value="<%= object.por %>"><%= object.por %></option>
                      <% }) %>
                      <!-- <option value="Web Nominee">Web Nominee</option>
                      <option value="Web Convenor">Web Convenor</option>
                      <option value="Design Secy">Design Secy</option>
                      <option value="Design Convenor">Design Convenor</option>
                      <option value="GSCA">GSCA</option>
                      <option value="GSHA">GSHA</option> -->
                    </select>
                  </div>
                </div>
              </div>
              <div class="row justify-content-center align-items-center m-3">
                <div class="col-3 text-center">
                  <h5>Interests</h5>
                </div>
                <div class="col-sm-9">
                  <div class="">
                    <select id="interests" multiple data-multi-select-plugin>
                      <% interests.forEach(function(object){ %>
                       <option value="<%= object.interest %>"><%= object.interest %></option>
                      <% }) %>
                      <!-- <option value="Writing">Writing</option>
                      <option value="Chess">Chess</option>
                      <option value="Sketching">Sketching</option>
                      <option value="Photography">Photography</option>
                      <option value="Travelling">Travelling</option>
                      <option value="Video Games">Video Games</option> -->
                    </select>
                  </div>
                </div>
              </div>
              <div class="containe-fluid">
                <div class="row justify-content-center align-items-center m-3">
                  <div class="col-3 text-center">
                    <h5> Skills</h5>
                  </div>
                  <div class="col-sm-9">
                    <div class="">
                      <select id="skills" multiple data-multi-select-plugin>
                        <% skills.forEach(function(object){ %>
                         <option value="<%= object.skill %>"><%= object.skill %></option>
                        <% }) %>
                        <!-- <option value="Programming">Programming</option>
                        <option value="Data Analysis">Photo Editing</option>
                        <option value="Graphic Design">Graphic Design</option>
                        <option value="Copywriting">Copywriting</option>
                        <option value="Animation">Animation</option> -->
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <!-- <div class="row justify-content-center">
                <div class="col-auto">
                  <a href="#" class="button btn-singin">Search</a>
                </div>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>

  <section id="results">
   <div class="container-md">
    <div class="row">
      <% if(details) { %>
      <% details.forEach(function(user){ %>
           <div class="col-lg-4 col-md-6 col-sm-6 col">
             <div class="single-profile">
               <div class="profile-details">
                 <div class="name-initials">
                   <p><%= user.name.match(/\b(\w)/g).join('') %></p>
                 </div>
                 <div class="text-center">
                   <h5 class="profile-title"><%= user.name %></h5>
                    <% if(user.gradyr){ %> <span><b><small><%= user.gradyr %></small></b>,</span> <% } %>
                    <% if(user.hostel){ %> <span><b><small><%= user.hostel %></small></b></span> <% } %>
                 </div>
                 <div class="profile-info">
                   <p>Skills :
                     <div class="tag">
                       <% if(user.skill_1){ %><span class="tag-label"><%= user.skill_1 %></span><%
                       let badge;
                       switch(user.skill_1_value){
                         case '1' : badge = 'BGN';
                                    break;
                         case '2' : badge = 'INT';
                                    break;
                         case '3' : badge = 'ADV';
                                    break;
                       }
                       %><span class="badge bg-secondary"><%= badge %></span><% } %>
                     </div>
                     <div class="tag">
                       <% if(user.skill_2){ %><span class="tag-label"><%= user.skill_2 %></span><%
                       let badge;
                       switch(user.skill_2_value){
                         case '1' : badge = 'BGN';
                                    break;
                         case '2' : badge = 'INT';
                                    break;
                         case '3' : badge = 'ADV';
                                    break;
                       }
                       %><span class="badge bg-secondary"><%= badge %></span><% } %>
                     </div>
                     <div class="tag">
                       <% if(user.skill_3){ %><span class="tag-label"><%= user.skill_3 %></span><%
                       let badge;
                       switch(user.skill_3_value){
                         case '1' : badge = 'BGN';
                                    break;
                         case '2' : badge = 'INT';
                                    break;
                         case '3' : badge = 'ADV';
                                    break;
                       }
                       %><span class="badge bg-secondary"><%= badge %></span><% } %>
                     </div></p>
                   <p>Intrests : <% user.interests.forEach(interest => { %>
                     <div class="tag">
                       <span class="tag-label"><%= interest %></span>
                     </div>
                   <% }) %></p>
                   <p>PoR's : <% user.pors.forEach(por => { %>
                     <div class="tag">
                       <span class="tag-label"><%= por %></span>
                     </div>
                   <% }) %></p>
                   <p>Email : <a href="mailto:<%= user.email %>"><%= user.email %></a></p>
                   <p>WA No : <%= user.wano %></p>
                 </div>

                 <div class="social-media-links">
                   <ul class="social-icons">
                     <li><a class="facebook" href='<%= user.fbLink %>'><i class="fa fa-facebook"></i></a></li>
                     <li><a class="instagram" href='<%= user.instaLink %>'><i class="fa fa-instagram"></i></a></li>
                     <li><a class="linkedin" href='<%= user.linkedinLink %>'><i class="fa fa-linkedin"></i></a></li>
                   </ul>
                 </div>
               </div>
             </div>
              </div>
        <% }) %>
        <% } %>
    </div>
   </div>
  </section>
</section>


  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-8 col-sm-6 col-xs-12">
          <p class="copyright-text">Copyright &copy; 2022 All Rights Reserved by Cultural Council IITB .</p>
        </div>
        <div class="col-md-4 col-sm-6 col-xs-12">
          <ul class="social-icons">
            <li><a class="facebook" href="https://www.facebook.com/IITBCult/"><i class="fa fa-facebook"></i></a></li>
            <li><a class="instagram" href="https://www.instagram.com/culturals.iitb/"><i class="fa fa-instagram"></i></a></li>
            <li><a class="linkedin" href="https://www.linkedin.com/company/culturals-iit-bombay/"><i class="fa fa-linkedin"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <script type="text/javascript">
    const searchBtn = document.querySelector('#search-btn');
    const form = document.querySelector('form');
    //console.log(location.search);
    const urlParams = new URLSearchParams(location.search);
    form.name.value = urlParams.get("name");
    if (urlParams.has('pors')) {
      const pors = urlParams.get('pors').split(',');
      const options1 = document.querySelectorAll("#pors option");
      options1.forEach(option => {
        if (pors.includes(option.value)) {
          option.setAttribute("selected","");
        }
      });
    }
    if (urlParams.has('interests')) {
      const interests = urlParams.get('interests').split(',');
      const options = document.querySelectorAll("#interests option");
      options.forEach(option => {
        if (interests.includes(option.value)) {
          option.setAttribute("selected","");
        }
      });
    }
    if (urlParams.has('skills')) {
      const skills = urlParams.get('skills').split(',');
      const options2 = document.querySelectorAll("#skills option");
      options2.forEach(option => {
        if (skills.includes(option.value)) {
          option.setAttribute("selected","");
        }
      });
    }

    if (document.querySelector('#results .container-md .row').childNodes[1]) {
      document.querySelector('#search').scrollIntoView();
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = form.name.value;
      const skills = [];
      const interests = [];
      const pors = [];

      const selected = document.querySelectorAll("#interests option[selected]");
      selected.forEach( interest => interests.push(interest.innerText));

      const selected1 = document.querySelectorAll("#pors option[selected]");
      selected1.forEach( por => pors.push(por.innerText));

      const selected2 = document.querySelectorAll("#skills option[selected]");
      selected2.forEach( skill => skills.push(skill.innerText));


      urlParams.set('name', name);
      urlParams.set('skills', skills);
      urlParams.set('pors', pors);
      urlParams.set('interests', interests);

      document.location.search = urlParams;


      try {
          const res = await fetch('/', {
          method: 'GET',
          headers: {'Content-type': 'application/json'}
        });
      }
      catch (err) {
         console.log(err);
      }
    });
  </script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384- MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
